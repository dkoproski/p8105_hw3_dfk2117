---
title: "p8105_hw3_dfk2117"
author: "Dylan Koproski"
date: "2023-10-08"
output: github_document
---
## Requried Data and Libraries
```{r}
library(p8105.datasets)
library(tidyverse)
data("instacart")
data("brfss_smart2010")
```

## Problem 1

```{r}

df_aisles = 
  instacart |> 
  group_by(aisle_id) |> 
  summarise(n_aisle = n()) |> 
  arrange(desc(n_aisle))

df_aisles
```

Using the `group_by()` function and the `summarise()` function, we see that there are 134 different aisles. Further, using `arrange()`, we can see that 83, 24,123,120,21 are the 5 most ordered-from aisles.

```{r}
df_aisles |> 
  filter(n_aisle > 10000) |> 
  ggplot(aes(x = aisle_id, y = n_aisle)) +
  geom_point()

```


```{r}
df_bi_dfc_pvf = 
  instacart |> 
  filter(aisle == "baking ingredients", aisle == "dog food care", aisle == "packaged_vegetable_fruits")
```


## Problem 2

### Cleaning the dataframe

```{r}
df_brfss =
  brfss_smart2010 |> 
  janitor::clean_names() |> 
  rename(state_abbr = locationabbr,
         state_county = locationdesc) |> 
  filter(topic == "Overall Health") |> 
  filter(response %in% c("Excellent", "Fair", "Very good", "Good", "Poor")) |> 
    mutate(response = factor(response, levels = c("Excellent", "Very good", "Good", "Fair", "Poor"), ordered = TRUE))
```

Here I make a dataframe called `df_brfss` so that I do not alter the original dataframe. I used `clean_names()` to tidy the variable names, but I also had to use the `rename()` function on `locationabbr` and `locationdesc` since their names were not intuitive and difficult to read. I used the `filter()` function two times, once to filter only the `Overall Health` topic and the other to filter the specified `responses`. Finally, I made response into a factor variable with levels Excellent - Poor in descending order using `mutate()`.

### In 2002, which states were observed at 7 or more locations? What about in 2010?

```{r}
n_state_2002 =
  df_brfss |> 
  filter(year == 2002) |> 
  group_by(state_abbr) |> 
  count(geo_location) |> 
  count(state_abbr) |> 
  filter(n >= 7)

n_state_2010 =
  df_brfss |> 
  filter(year == 2010) |> 
  group_by(state_abbr) |> 
  count(geo_location) |> 
  count(state_abbr) |> 
  filter(n >= 7)

n_state_2002
n_state_2010
```
I interpreted this question as looking for the number of states (`state_abbr`) that contain observations from 7 or more unique `geo_location`. I did this by first using `filter()` to focus on the correct year, then I used the `group_by()` function to group the dataset by state abbreviation. After this, I used `count()` twice, first to count the occurrence of each unique `geo_location` observation within each state, then another time to count the occurrence of each `state_abbr` corresponding to each `geo_location`. Finally, I `filter()` once more to only focus on states with greater than 7 locations. The result is a count of unique `geo_location` observations within each `state_abbr`. In 2002, 6 states were observed at 7 or more geographic locations. In 2010, 14 states were observed at 7 or more geographic locations.

### Construct a dataset that is limited to Excellent responses, and contains, year, state, and a variable that averages the data_value across locations within a state. Make a “spaghetti” plot of this average value over time within a state (that is, make a plot showing a line for each state across years – the geom_line geometry and group aesthetic will help).

```{r}
df_exc_resp = 
  df_brfss |> 
  filter(response == 'Excellent') |> 
  group_by(year, state_abbr) |> 
  summarise(avg_dv_pct = mean(data_value)) |> 
  ungroup() |> 
  ggplot(aes(x = year, y = avg_dv_pct, group = state_abbr, color = state_abbr)) +
  geom_line() +
  labs(title = "Average Data Value of Excellent Responses Over Years by State",
       x = "Year",
       y = "Average Data Value (%)") +
  theme_minimal() +
  theme(legend.position = "right")

```

### Make a two-panel plot showing, for the years 2006, and 2010, distribution of data_value for responses (“Poor” to “Excellent”) among locations in NY State.

```{r}
plot_dv_2006_2010 =
  df_brfss |> 
  filter(year %in% c(2006, 2010), 
         state_abbr == "NY", 
         response %in% c("Poor", "Fair", "Good", "Very good", "Excellent")) |> 
  group_by(year, geo_location, response) |> 
  ggplot(aes(x = response, y = data_value, group = geo_location, color = geo_location)) +
  geom_line() +
  facet_grid(~year) +
  labs(title = "Data Value for Poor-Excellent Responses in NY State",
       x = "Response",
       y = "Data Value")

plot_dv_2006_2010
```


## Problem 3

```{r}

```


